<html>
  <head>

    <link rel="stylesheet" type="text/css" href="css/silverfox.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">


    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">

      var INCOME_TAX = 0.2;
      var RETIREMENT_AGE_BASE = 55;
      var PENSION_LIMIT = 0.25;
      var MONTHS_IN_YEAR = 12;
      var ANNUITY_RATE_PER_YEAR = 0.1;
      var ANNUITY_RATE_AT_55 = 4;
      var PERCENTAGE_DENOMINATOR = 100;

      function Calculator (pensionPot, monthlySpending, monthlyIncome, retirementAge) {
          this.pensionPot = pensionPot;
          this.monthlySpending = monthlySpending;
          this.monthlyIncome = monthlyIncome;
          this.retirementAge = retirementAge;

          this.setLumpSum = function(lumpSum) {
              return this.lumpSum = lumpSum;
          };

          this.monthlyAnnuityRequirement = function() {
            return Math.max(this.monthlySpending - this.monthlyIncome, 0);
          }

          this.yearlyAnnuityRequirement = function() {
            return this.monthlyAnnuityRequirement() * MONTHS_IN_YEAR;
          }

          this.annuityRate  = function() {
            return ((this.retirementAge - RETIREMENT_AGE_BASE) * ANNUITY_RATE_PER_YEAR + ANNUITY_RATE_AT_55)
                / PERCENTAGE_DENOMINATOR;
          }

          this.pensionForAnnuity  = function() {
              return this.yearlyAnnuityRequirement() / this.annuityRate();
          }

          this.pensionLeftOver  = function() {
            return this.pensionPot - this.pensionForAnnuity();
          }

          this.percentageOfPension  = function() {
            return this.lumpSum / this.pensionPot;
          }

          this.amountOverLimit  = function() {
            return Math.max(this.percentageOfPension() - PENSION_LIMIT, 0);
          }

          this.taxableLumpSum  = function() {
            return this.pensionPot * this.amountOverLimit();
          }

          this.taxPaid  = function() {
            return this.taxableLumpSum() * INCOME_TAX;
          }

          this.lumpAmountMinusTax  = function() {
            return this.lumpSum - this.taxPaid();
          }

          this.investmentAmount  = function() {
            return this.pensionPot - this.lumpSum - this.pensionForAnnuity();
          }
      }

      // Load the Visualization API and the controls package.
      google.load('visualization', '1.0', {'packages':['controls']});

      // Set a callback to run when the Google Visualization API is loaded.
      //google.setOnLoadCallback(drawDashboard);

      // Callback that creates and populates a data table,
      // instantiates a dashboard, a range slider and a pie chart,
      // passes in the data and draws it.
      function drawDashboard(annuity, lumpSum, flexiAccess, tax) {

        // Create our data table.
        var data = google.visualization.arrayToDataTable([
          ['Name', 'Amount £k'],
          ['Lump Sum' , lumpSum],
          ['Annuity', annuity],
          ['Flexi-Access', flexiAccess],
          ['Tax', tax]
        ]);

        // Create a dashboard.
        var dashboard = new google.visualization.Dashboard(
            document.getElementById('dashboard_div'));

        // Create a range slider, passing some options
        var donutRangeSlider = new google.visualization.ControlWrapper({
          'controlType': 'NumberRangeFilter',
          'containerId': 'filter_div',
          'options': {
            'filterColumnLabel': 'Amount £k'
          }
        });

        // Create a pie chart, passing some options
        var pieChart = new google.visualization.ChartWrapper({
          'chartType': 'PieChart',
          'containerId': 'chart_div',
          'options': {
            'width': 500,
            'height': 500,
            'pieSliceText': 'value',
            'legend': 'right',
            'pieHole': 0.4,
            'backgroundColor': '#eae8e8',
            'colors': ['#666666', '#cf2e02', '#969696', '#dbdbdb', '#eae8e8', '#d95835']
          }
        });

        // Establish dependencies, declaring that 'filter' drives 'pieChart',
        // so that the pie chart will only display entries that are let through
        // given the chosen slider range.
        dashboard.bind(donutRangeSlider, pieChart);

        // Draw the dashboard.
        dashboard.draw(data);
      }

      function calculate() {

        var pensionPot = document.getElementById("pension_pot").value;
        var monthlyIncome = document.getElementById("monthly_income").value;
        var monthlySpending = document.getElementById("monthly_spending").value;
        var retirementAge = document.getElementById("retirement_age").value;

        var calculator = new Calculator(pensionPot, monthlySpending, monthlyIncome, retirementAge);
        calculator.setLumpSum(300000);

        drawDashboard(calculator.pensionForAnnuity(),
                      calculator.lumpAmountMinusTax(),
                      calculator.investmentAmount(),
                      calculator.taxPaid());
      }
    </script>
  </head>

  <body>
    <div class="row"></div>
    
    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-4">
        <div class="input-group">
          <span class="input-group-addon">£</span>
          <input type="text" class="form-control" id="pension_pot"  placeholder="Total Pension Pot">
        </div>
      </div>
      <div class="col-md-4"></div>
    </div>

    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-4">
        <div class="input-group">
          <span class="input-group-addon">£</span>
          <input type="text" class="form-control" id="monthly_spending"  placeholder="Monthly Outgoings">
        </div>
      </div>
      <div class="col-md-4"></div>
    </div>

    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-4">
        <div class="input-group">
          <span class="input-group-addon">£</span>
          <input type="text" class="form-control" id="monthly_income"  placeholder="Other Monthly Income">
        </div>
      </div>
      <div class="col-md-4"></div>
    </div>

    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-4">
        <div class="input-group">
          <span class="input-group-addon">£</span>
          <input type="text" class="form-control" id="retirement_age"  placeholder="Age at Retirement">
        </div>
      </div>
      <div class="col-md-4"></div>
    </div>
    
    <div class="row" id="calc_button">
      <div class="col-md-5"></div>
      <div class="col-md-2">
        <button type="button" class="btn btn-default center-block" onclick="calculate();">Calculate</button>
      </div>
      <div class="col-md-5"></div>
    </div>
    
    

    <!--Div that will hold the dashboard-->
    <div id="dashboard_div"  class="row">
      <!--Divs that will hold each control and chart-->
      <div class="col-md-4"></div>
      <div class="col-md-4">
        <div id="chart_div"></div>
      </div>
      <div class="col-md-4"></div>
    </div>

    <div id="dashboard_div"  class="row">
      <!--Divs that will hold each control and chart-->
      <div class="col-md-4"></div>
      <div class="col-md-4">
        <div id="filter_div"></div>
      </div>
      <div class="col-md-4"></div>
    </div>
    


  </body>
</html>